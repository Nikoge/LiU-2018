---
title: "Computational Statistics (732A90) Lab3"
author: "Anubhav Dikshit(anudi287) and Thijs Quast(thiqu264)"
date: "23 January 2019"
output: 
    pdf_document:
      toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newpage

# Question 1: Cluster sampling

##1. Import necessary information to R.
```{r}
data <- read.csv2("population.csv", header = TRUE)
```

##2. Use a uniform random number generator to create a function that selects 1 city from the whole list by the probability scheme offered above (do not use standard sampling functions present in R).

```{r}
fthreebits<-function(k,s,L,N){
  
    X0 <- 4*s+1;
    a<-8*k+5;
    m<-2^L;
    X<-X0
  temp <- NULL
  
    for (i in 1:N){
	 X <- (a*X)%%m ##c=0
	 temp <- rbind(X, temp)
    }
    return(temp)
}


```

##3. Use the function you have created in step 2 as follows: (a) Apply it to the list of all cities and select one city. (b) Remove this city from the list. (c) Apply this function again to the updated list of the cities. (d) Remove this city from the list. (e) : : : and so on until you get exactly 20 cities.

```{r}

# applied and removed one city from the list
df <- data
df <- df[row.names(df) != fthreebits(k=3,s=5,L=8,N=10)[1:1],]
df <- df[row.names(df) != fthreebits(k=3,s=5,L=8,N=10)[2:2],]

final_city <- NULL
final <- NULL
i = 0
temp <- unique(fthreebits(k=5,s=7,L=8,N=1000))
while(NROW(final_city) < 20){
  X <- temp[i:i]
  final <- c(X, final)
  final <- unique(final)
  final_city <- df[rownames(df) %in% final,]
    i = i+1
}



  

```

##4. Run the program. Which cities were selected? What can you say about the size of the selected cities?

```{r}

options(scipen=999)

library(ggplot2)

final_city$Municipality

data$flag <- ifelse(data$Municipality %in% final_city$Municipality, "Selected", "Unselected")


```

##5. Plot one histogram showing the size of all cities of the country. Plot another histogram showing the size of the 20 selected cities. Conclusions?

```{r}
library(dplyr)

data %>% filter(flag == "Selected") %>% ggplot(., aes(Population)) + geom_histogram(bins=30) + ggtitle("Histogram of Selected cities")

data %>% filter(flag == "Unselected") %>%ggplot(., aes(Population)) + geom_histogram(bins=30) + ggtitle("Histogram of Unselected Citites")

ggplot(data, aes(Population, fill=flag, colour=flag)) + geom_histogram(bins=30) + ggtitle("Histogram of Unselected vs. Selected Citites")

```

#Question 2: Different distributions

###The double exponential (Laplace) distribution is given by formula:

$$ DE(\mu, \alpha) = \frac{\alpha}{2} \exp{(-\alpha|x - \mu|)} $$

The inverse function would be

$$ X = \mu - b * sgn(U) \ln(1-2|U|) $$

##1. Write a code generating double exponential distribution DE(0; 1) from Unif(0; 1) by using the inverse CDF method. Explain how you obtained that code step by step. Generate 10000 random numbers from this distribution, plot the histogram and comment whether the result looks reasonable.

```{r}
#X = m - b * sign(U) * log(1-2*abs(U))

myfunc = function(n,mu,alpha){
  U = runif(n,0,1)
  y = mu - alpha * sign(U) * log(1-2*abs(U))
  return(y)
}


double_exp = function(n,mu,alpha){
    x = runif(n,0,1)
    y = 0.5*alpha * exp(-alpha * abs(x-mu))
    return(y)
}


plot(myfunc(n=10000,mu=0,alpha=1))
plot(double_exp(n=10000,mu=0,alpha=1))

# testing from external library
plot(rmutil::dlaplace(y = runif(10000,0,1), m=0, s=1, log=FALSE))

```

##2. Use the Acceptance/rejection method with DE(0; 1) as a majorizing density to generate N(0; 1) variables. Explain step by step how this was done. How did you choose constant c in this method? Generate 2000 random numbers N(0; 1) using your code and plot the histogram. Compute the average rejection rate R in the acceptance/rejection procedure. What is the expected rejection rate ER and how close is it to R? Generate 2000 numbers from N(0; 1) using standard rnorm() procedure, plot the histogram and compare the obtained two histograms.

```{r}

```




#Appendix
```{r, ref.label=knitr::all_labels(),echo=TRUE,eval=FALSE}
```